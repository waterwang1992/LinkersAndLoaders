# <center>温故而知新</center> 

***

## 1.1 从hello world 说起 

```
#include <stdio.h>

int main(int argc, const char * argv[]) {
    // insert code here...
    printf("Hello, World!\n");
    return 0;
}

```

几个问题

- 程序为什么编译了之后才可以运行
- 编译器把C语言程序转换成可以执行的机器码的过程做了什么?怎么做的?
- 最后编译出来的可执行的文件里是什么?除了机器码还有什么?他们怎么存放的?怎么组织的?
- ```#include <stdio.h>``` 是什么含义? 把 ```stdio.h```包进来意味着什么?C语言库又是什么?他们怎么实现的?
- 不同的编译器和不同的硬件平台以及不同的操作系统最终编译出来的结果一吗?为什么?
- Hello World 程序是怎样运行起来的? 操作系统是怎样装载它的?从哪儿开始执行?到哪儿结束?main函数之前发生了什么?main函数之后发生了什么?应该怎么实现?
- prinf是怎么实现的?它为什么可以有不定数量的参数?为什么它能够在终端上输出字符串?
- Hello World 在程序中运行时,它的内存是什么样子的?

不着急慢慢解决.

***

## 1.2 万变不离其宗

计算机是非常广泛的概念, 本书将计算机定义为最流行最为广泛的PC机,采用兼容X86指令集的32位CPU的个人计算机,各种平台的软硬件千差万别,但本质上基本概念和工作原理都是一样的,只需掌握一种便可举一反三,触类旁通.

撇开其他,计算机的核心: 中央处理器, 内存和I/O控制芯片.

早期计算机, CPU核心频率不高,跟内存一样, CPU和内寸连接在总线(Bus)上. I/O设备, 速度很慢,控制器用来协调.

___早期计算机硬件结构___
![早期计算机硬件结构](resource/早期计算机硬件结构.png)

CPU速度提升, 图形化操作系统普及,  CPU与内存大量交换数据,  慢速I/O总线已无法满足需求. 南北桥芯片

___硬件结构框架(PCI/ISA及南北桥设计)___
![硬件结构框架](resource/硬件结构框架.png)

__SPM与多核__

过去几十年 每18个月 CPU频率就翻一倍.  几十kHz至4GHz, 由于制作工艺的物理极限, 04年似乎达到了极限. 没有了质的飞越.

__SMP__

```Symmetrical Multi-Processing``` __对称多处理器__

```
简单来讲,每个CPU所处的地位与发挥的功能都是一样的,是相互对称的.
```

理想情况下, 速度的提高与CPU数量成正比,但是程序并不能分解成若干个完全不相干的子问题.

```
一个女人10个月能生一个孩子, 十个女人不能一个月生一个孩子.
```

多处理器也比较常见, 例如 需要大量计算的, 大型数据库和网络服务

__多核__

个人电脑,多处理器是比较奢侈的行为.

```
厂商考虑将多个处理器"合并在一起打包出售", 这些处理器之间共享比较昂贵的缓存部件,只保留多个核心,
并且以一个处理器的外包装进行出售,售价比单核心得处理器只贵了一点,这就是多核处理器的基本想法
```

可以这么认为:```多核```实际上是```SMP```的简化版.


对于程序员来讲, 除非把处理器的每一滴油水都榨干, 否则可以把```多核```和```SMP```看成同一个概念.

***

## 1.3 站的高,看的远

<table>
    <tr>
        <td colspan="3" align="center">软件</td>
    </tr>
    <tr>
        <td align="center">平台性的</td>
        <td align="center">用于程序开发的</td>
        <td align="center">普通的应用程序</td>            
    </tr>
    <tr>
        <td align="center">操作系统<br>驱动程序<br>运行库<br>数以千计的系统工具</td>
        <td align="center">编译器<br>汇编器<br>链接器<br>等开发工具和开发库</td>
        <td align="center">略</td>
    </tr>
</table>

引用无从考证的一句话:

```
计算机科学领域的任何一个问题都可以通过增加一个间接层来解决
```

计算机软件体系结构:

![计算机软件体系结构](resource/计算机软件体系结构.png)

本文着重介绍 连接器和库(包括运行库和开发库)等香瓜内容
***
## 1.4操作系统做什么?

<table>
    <tr>
        <td colspan="2" align="center">操作系统功能</td>
    </tr>
    <tr>
        <td align="center">提供抽象的接口</td>
        <td align="center">管理硬件资源</td>    
    </tr>
</table>

计算机硬件能力有限, 计算机主要资源: CPU 存储器(包括内存和磁盘)和I/O设备, 分别从这三个方面来看看如何挖掘他们的潜力.

### 1.4.1 不要让CPU打盹
 早期: ___多道程序(MutiProgramming)___:某个程序无法使用CPU时,监控程序把另外正在等待CPU资源的程序启动,是的CPU能够充分的利用起来.

缺点: 不分轻重缓急, 紧急的需要使用CPU资源的应用程序可能要等待很久才有机会分配到CPU

```
Windows 上点击鼠标 十分钟后系统才响应, 是多么令人沮丧的一件事.
```

改进1: ___分时系统(Time-Sharing System):每个程序运行一段时间后,主动让出CPU给其他应用程序,是的每段时间每个程序都有机会运行一小段时间,这对于一些交互式任务尤其重要. 完整的操作系统雏形已经逐渐形成
缺点:如果一个程序进行一个很耗时的计算, 一直霸占着CPU不放, 操作系统也没有办法


























